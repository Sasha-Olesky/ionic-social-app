angular.module('starter.session', [])
.factory('Session', function (APIManager) {
	var setSession = function(name, value) {
		if (window.localStorage[name]) {
			window.localStorage.removeItem(name);
		}
		window.localStorage[name] = JSON.stringify(value);
	};
	var getSession = function(name) {
		var val = null;
		if (window.localStorage[name]) {
			val = JSON.parse(window.localStorage[name]);
		}
		return val;
	};
	var clearSession = function(name) {
		if (window.localStorage[name]) {
			window.localStorage.removeItem(name);
		}
	};
    return {
		setSession : setSession,
		getSession : getSession,
		clearSession : clearSession,
        isLoggedIn: function () {
			var _user = getSession('user');
            return _user ? true : false;
        },
        logout: function () {
			var user = getSession('user');
            var url = 'set_online';
			var data = {userid:user.id, online:0};
			APIManager.get(url, data);
			clearSession('user');
			clearSession('list_dependents');
        }		
    }
});